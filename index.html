<html>
<head>
    <title>Apple Small MP4 Bug</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * {
            font-size: 100%;
            font-family: Arial, sans-serif;
        }

        code {
            font-family: monospace;
            background-color: rgb(204, 243, 253);
        }

        .example-img {
            display: inline-block;
            border: 1px solid #333;
        }

        .bad > p {
            margin: 0px;
            padding: 5px;
        }

        .clickable {
            cursor: pointer;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <p>Some Apple iOS devices crash when viewing small MP4 files (below about 250px wide), either in an <code>img</code> or <code>video</code> tag, or when visiting them directly.</p>
    <p>If you are using an newer iPhone (XS, XR, XS Max, etc) or iPad (2018, 2019+), pressing the <strong>Render Bad MP4</strong> button will crash your browser.</p>
    <p class="devinfo hidden">
        Device Information (powered by <a href="https://web.wurfl.io/#wurfl-js" target="_blank">WURFL.js</a>):<br>
        <strong>Device</strong>: <span class="device"></span><br>
        <strong>Browser</strong>: <span class="browser"></span><br>
        <strong>OS</strong>: <span class="os"></span>
    </p>
    <p>See <a href="https://github.com/kamermans/ios-small-mp4-bug" target="_blank">the github repo</a> for the full source, including the Adobe Photoshop PSD source file.</p>
    <hr>
    <p>This animated GIF is <code>256x64</code>:<br>
        <div class="example-img"><img src="assets/256x64.gif"></div>
    </p>

    <p>This is the same animation as an MP4 in an <code>&lt;img&gt;</code> tag:<br>
        <div class="example-img"><img src="assets/256x64.mp4"></div><br>
        <em>Note: this will only work on Apple Devices</em>
    </p>
    <hr>

    <p>This animated GIF is cropped slightly smaller, at <code>232x40</code>:<br>
        <div class="example-img"><img src="assets/232x40.gif"></div>
    </p>

    <p>This is the same animation as an MP4 in an <code>&lt;img&gt;</code> tag:<br>
        <div class="example-img bad img-tag clickable"><p>Click to load the MP4 in an <code>&lt;img&gt;</code> tag.<br>This will freeze newer iPhones &amp; iPods<br>and is unsupported on all other devices.</p></div><br>
    </p>

    <p>This is the same animation as an MP4 in a <code>&lt;video&gt;</code> tag:<br>
        <div class="example-img bad video-tag clickable"><p>Click to load the MP4 in a <code>&lt;video&gt;</code> tag.<br>This will freeze newer iPhones &amp; iPods</p></div><br>
        You can also <a href="assets/232x40.mp4" target="_blank">load this MP4 in another tab</a> to see it crash there.
    </p>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const badImgDiv = document.querySelector('.example-img.bad.img-tag')
        const badVidDiv = document.querySelector('.example-img.bad.video-tag')
        badImgDiv.addEventListener('click', e => {
            badImgDiv.innerHTML = '<img src="assets/232x40.mp4">';
        });
        badVidDiv.addEventListener('click', e => {
            badVidDiv.innerHTML = '<video autoplay loop><source src="assets/232x40.mp4" type="video/mp4"></video>';
        });
    });

    document.addEventListener('WurflJSDetectionComplete', () => {
        if (WURFL.complete_device_name !== undefined) {
            document.querySelector('.device').innerHTML = WURFL.complete_device_name;
            document.querySelector('.browser').innerHTML = `${WURFL.advertised_browser} ${WURFL.advertised_browser_version}`;
            document.querySelector('.os').innerHTML = `${WURFL.advertised_device_os} ${WURFL.advertised_device_os_version}`;
            document.querySelector('.devinfo').classList.remove('hidden');
        }
    });
    </script>
    <script async src="https://wjs.wurflcloud.com/wurfl.js"></script>
</body>
</html>